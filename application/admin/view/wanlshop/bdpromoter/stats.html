<style>
.stats-container { padding: 20px; }
.stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 30px; }
.stats-card { background: #fff; border-radius: 8px; padding: 20px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.stats-card .value { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
.stats-card .label { font-size: 14px; color: #999; }
.stats-card.green .value { color: #52c41a; }
.stats-card.blue .value { color: #1890ff; }
.stats-card.orange .value { color: #fa8c16; }
.stats-card.red .value { color: #f5222d; }
.time-filter { margin-bottom: 20px; }
.time-filter .btn { margin-right: 10px; }
.top-list { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.top-list h4 { margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 1px solid #eee; }
</style>

<div class="panel panel-default panel-intro">
    <div class="panel-heading">
        <div class="panel-lead"><em>BD统计报表</em>BD推广员数据统计分析</div>
    </div>
    <div class="panel-body">
        <div class="stats-container">
            <!-- 时间筛选 -->
            <div class="time-filter">
                <div class="btn-group" data-toggle="buttons">
                    <label class="btn btn-default active" data-type="today">
                        <input type="radio" name="time" autocomplete="off" checked> 今日
                    </label>
                    <label class="btn btn-default" data-type="3days">
                        <input type="radio" name="time" autocomplete="off"> 近3天
                    </label>
                    <label class="btn btn-default" data-type="7days">
                        <input type="radio" name="time" autocomplete="off"> 近7天
                    </label>
                    <label class="btn btn-default" data-type="30days">
                        <input type="radio" name="time" autocomplete="off"> 近30天
                    </label>
                </div>
            </div>

            <!-- 统计卡片 -->
            <div class="stats-grid">
                <div class="stats-card blue">
                    <div class="value" id="new_bd_count">-</div>
                    <div class="label">新增BD</div>
                </div>
                <div class="stats-card green">
                    <div class="value" id="new_shop_bind_count">-</div>
                    <div class="label">新增店铺绑定</div>
                </div>
                <div class="stats-card orange">
                    <div class="value" id="active_bd_count">-</div>
                    <div class="label">活跃BD数</div>
                </div>
                <div class="stats-card green">
                    <div class="value" id="total_commission">-</div>
                    <div class="label">产生佣金</div>
                </div>
                <div class="stats-card blue">
                    <div class="value" id="net_commission">-</div>
                    <div class="label">净佣金</div>
                </div>
            </div>

            <!-- BD排行榜 -->
            <div class="top-list">
                <h4><i class="fa fa-trophy"></i> BD佣金排行榜 (TOP 10)</h4>
                <table class="table table-striped" id="top-bd-table">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>BD用户</th>
                            <th>推广码</th>
                            <th>佣金金额</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" class="text-center">加载中...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
require(['jquery'], function($) {
    var loadStats = function(type) {
        $.ajax({
            url: 'wanlshop/bdpromoter/stats',
            type: 'GET',
            data: { type: type },
            dataType: 'json',
            success: function(res) {
                if (res.code === 1) {
                    var data = res.data;
                    $('#new_bd_count').text(data.new_bd_count);
                    $('#new_shop_bind_count').text(data.new_shop_bind_count);
                    $('#active_bd_count').text(data.active_bd_count);
                    $('#total_commission').text('¥' + parseFloat(data.total_commission).toFixed(2));
                    $('#net_commission').text('¥' + parseFloat(data.net_commission).toFixed(2));

                    // 排行榜
                    var html = '';
                    if (data.top_bd_list && data.top_bd_list.length > 0) {
                        for (var i = 0; i < data.top_bd_list.length; i++) {
                            var item = data.top_bd_list[i];
                            html += '<tr>';
                            html += '<td>' + (i + 1) + '</td>';
                            html += '<td>' + (item.nickname || '-') + '</td>';
                            html += '<td><code>' + (item.bd_code || '-') + '</code></td>';
                            html += '<td class="text-success">¥' + parseFloat(item.total_commission).toFixed(2) + '</td>';
                            html += '</tr>';
                        }
                    } else {
                        html = '<tr><td colspan="4" class="text-center text-muted">暂无数据</td></tr>';
                    }
                    $('#top-bd-table tbody').html(html);
                }
            }
        });
    };

    // 初始加载
    loadStats('today');

    // 时间切换
    $('.time-filter .btn').on('click', function() {
        var type = $(this).data('type');
        loadStats(type);
    });
});
</script>
