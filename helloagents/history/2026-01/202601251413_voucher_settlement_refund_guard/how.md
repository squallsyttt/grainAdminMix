# 怎么做（How）

## 方案概述

1. **服务端兜底拦截**：在结算打款服务中查询退款表，发现退款进行中/已成功则直接拒绝打款。
2. **后台操作入口拦截**：结算管理控制器在获取收款人、打款弹窗、标记已结算等入口增加同样的拦截，提升交互一致性。
3. **前端按钮禁用**：结算管理列表展示券状态，并在已退款/退款中时禁用“结算打款/重试”按钮，降低误操作概率。

## 风险与规避

- 风险：仅靠前端禁用无法防止绕过请求。
  - 规避：服务端强制校验为唯一可靠防线。
- 风险：退款与结算并发导致状态不一致。
  - 规避：结算打款使用行锁读取结算记录，并在打款前二次校验退款状态。

## 兼容性

- 不新增数据表与字段；仅在关键入口处增加校验逻辑与展示字段。

