# 大米 B2B2C 平台小程序开发提示词

> 本文档用于指导 AI 代码生成工具，开发基于地理位置定价的大米销售小程序

---

## 一、项目核心业务逻辑

你正在开发一个**基于地理位置定价的大米 B2B2C 销售平台小程序**，核心特点如下：

### 1.1 业务模式

**平台统一商品展示模式**（非淘宝式商家店铺）
- 用户看到的是**平台统一的商品列表**，而非各个商家的店铺
- 商品按**大米品种**分类（如东北大米、泰国香米、五常稻花香等）
- **不展示商家信息**，用户购买前无法看到具体哪个商家供货

### 1.2 地理位置定价机制（核心功能）

**精确到地级市的区域定价**
```
业务逻辑：
1. 用户进入小程序时，自动获取地理位置（微信授权）
2. 根据定位解析出【地级市】（如：江苏省南通市）
3. 后端根据地级市返回该区域的商品价格
4. 同一品种大米在不同城市价格不同
   - 例如：五常稻花香 5kg
     - 南通市：¥89.00
     - 乌鲁木齐市：¥99.00
     - 哈尔滨市：¥79.00
```

**实现要点**：
- 首次进入必须授权地理位置，否则无法查看商品
- 用户可手动切换城市，查看不同城市的价格
- 价格显示格式：`¥89.00 (南通市)`
- 切换城市后，购物车价格同步更新

### 1.3 核销码 + 商家自提流程（核心功能）

**购买后的核心流程**：
```
用户下单并支付
    ↓
生成订单（状态：待核销）
    ↓
显示核销码（6位数字，如：238471）
    ↓
用户点击"查看自提点"
    ↓
显示当地可自提的商家列表
    ↓
用户选择商家，前往自提
    ↓
商家扫描核销码或输入核销码
    ↓
订单状态变更为"已核销"
```

**核销码页面布局**：
```
┌─────────────────────────┐
│   [订单信息]             │
│   五常稻花香 5kg × 2     │
│   ¥178.00               │
├─────────────────────────┤
│   【核销码】             │
│                         │
│      ┌─────────┐        │
│      │ 238471  │  (大字体显示) │
│      └─────────┘        │
│                         │
│   有效期：2025-10-16    │
├─────────────────────────┤
│   [可自提商家列表]       │
│                         │
│   📍 张三粮油店          │
│      南通市崇川区xx路xx号│
│      距离 2.3km          │
│      ☎️ 13800138000     │
│      [导航]  [拨打电话] │
│                         │
│   📍 李四米业            │
│      南通市港闸区xx路xx号│
│      距离 5.1km          │
│      ☎️ 13900139000     │
│      [导航]  [拨打电话] │
└─────────────────────────┘
```

**关键业务规则**：
- 核销码在**支付成功后立即生成**
- 核销码**有效期 7 天**，过期自动作废
- 商家列表**按距离排序**，显示最近 20 家
- 商家信息包括：名称、地址、电话、距离
- 提供**导航**（调用微信地图）和**拨打电话**功能
- 一个核销码**只能核销一次**
- 核销后订单状态变为"已核销"，不可退款

### 1.4 不存在的功能（重要）

**以下功能不需要实现**：
- ❌ 商家店铺首页
- ❌ 进入商家店铺浏览商品
- ❌ 商家关注/收藏
- ❌ 快递配送（只支持自提）
- ❌ 在线客服（暂不需要）
- ❌ 评价晒单（V1.0 不做）
- ❌ 优惠券系统（后续版本）
- ❌ 积分系统（后续版本）

---

## 二、技术栈要求

### 2.1 前端框架
- **uni-app**（Vue 2 语法）
- **uView UI 2.x** 组件库
- **Vuex** 状态管理
- 支持微信小程序

### 2.2 后端对接
- 后端框架：**ThinkPHP 5.x**
- API 前缀：`/api`
- 认证方式：Header 传递 `token`
- 响应格式：
  ```json
  {
    "code": 1,
    "msg": "操作成功",
    "data": {}
  }
  ```

### 2.3 地理位置服务
- 使用 **微信小程序 wx.getLocation()** 获取经纬度
- 使用 **腾讯地图 API** 或 **高德地图 API** 逆地理编码（经纬度 → 城市）
- 后端存储城市与价格的映射关系

---

## 三、核心页面结构

### 3.1 首页（index）

**布局结构**：
```
┌─────────────────────────┐
│  [顶部城市选择]          │
│  📍 南通市  [切换] 🔔    │
├─────────────────────────┤
│  [轮播广告]              │
│  [图片1] [图片2] [图片3] │
├─────────────────────────┤
│  [商品分类导航]          │
│  [东北大米] [泰国香米]   │
│  [五常稻花香] [有机米]   │
├─────────────────────────┤
│  [热销商品]              │
│  ┌──────┐ ┌──────┐      │
│  │ 图片 │ │ 图片 │      │
│  │ 标题 │ │ 标题 │      │
│  │ ¥89  │ │ ¥79  │      │
│  └──────┘ └──────┘      │
└─────────────────────────┘
```

**功能点**：
1. **顶部城市栏**
   - 显示当前定位城市
   - 点击可切换城市（弹出城市选择器）
   - 切换后价格实时更新

2. **轮播广告**
   - 支持跳转到商品详情或活动页

3. **商品分类导航**
   - 宫格布局，4 列
   - 点击进入商品列表页

4. **热销商品列表**
   - 双列网格展示
   - 显示：图片、标题、当前城市价格

### 3.2 商品列表页（goods/list）

**筛选条件**：
```
┌─────────────────────────┐
│  [当前城市] 南通市 [切换]│
├─────────────────────────┤
│  [分类筛选]              │
│  全部 | 东北大米 | 泰国香米│
├─────────────────────────┤
│  [排序]                  │
│  综合 | 销量 | 价格↑↓    │
├─────────────────────────┤
│  [商品列表]              │
│  ┌─────────────────┐    │
│  │ [图]  标题       │    │
│  │       规格：5kg  │    │
│  │       ¥89.00     │    │
│  │       (南通市价格) │   │
│  └─────────────────┘    │
└─────────────────────────┘
```

**业务逻辑**：
- 顶部固定显示当前城市，可切换
- 切换城市后，列表价格实时刷新
- 支持分页加载（下拉加载更多）
- 点击商品进入详情页

### 3.3 商品详情页（goods/detail）

**页面结构**：
```
┌─────────────────────────┐
│  [商品轮播图]            │
│  [图片1] [图片2]         │
├─────────────────────────┤
│  [商品信息]              │
│  五常稻花香大米          │
│  规格：5kg/袋            │
│                         │
│  ¥89.00                 │
│  (南通市价格)            │
│                         │
│  已售 1234 件           │
├─────────────────────────┤
│  [规格选择]              │
│  5kg  10kg  20kg        │
│  (不同规格价格不同)      │
├─────────────────────────┤
│  [商品详情]              │
│  产地：黑龙江五常        │
│  保质期：12个月          │
│  [详情图片1]             │
│  [详情图片2]             │
├─────────────────────────┤
│  [底部操作栏]            │
│  [加入购物车]  [立即购买]│
└─────────────────────────┘
```

**关键逻辑**：
- 价格显示当前城市价格，括号标注城市名
- 切换规格时，价格动态更新
- **加入购物车**：记录城市信息，价格与城市绑定
- **立即购买**：直接跳转到确认订单页

### 3.4 购物车页（cart）

**购物车结构**：
```
┌─────────────────────────┐
│  [当前城市] 南通市 [切换]│
├─────────────────────────┤
│  [商品列表]              │
│  ☑️ [图] 五常稻花香 5kg  │
│      ¥89.00 × 2         │
│      小计：¥178.00      │
│                         │
│  ☑️ [图] 泰国茉莉香米 10kg│
│      ¥129.00 × 1        │
│      小计：¥129.00      │
├─────────────────────────┤
│  [底部结算栏]            │
│  全选 ☑️                 │
│  合计：¥307.00          │
│  [去结算(2)]            │
└─────────────────────────┘
```

**重要业务规则**：
1. **城市切换影响价格**
   - 切换城市后，购物车商品价格自动更新
   - 弹窗提示："已切换至乌鲁木齐市，价格已更新"

2. **购物车数据结构**
   ```javascript
   {
     goods_id: 1,
     spec_id: 1,
     quantity: 2,
     city_code: '320600',  // 南通市代码
     price: 89.00          // 该城市的价格
   }
   ```

3. **结算校验**
   - 结算时必须确认当前城市
   - 如果定位城市与购物车城市不一致，提示用户
   - 弹窗："您当前在乌鲁木齐市，购物车商品为南通市价格，是否继续？"

### 3.5 确认订单页（order/confirm）

**订单确认页**：
```
┌─────────────────────────┐
│  [提示]                  │
│  ⚠️ 本订单为自提订单     │
│  支付后将生成核销码      │
│  凭核销码到商家自提      │
├─────────────────────────┤
│  [配送城市]              │
│  📍 南通市               │
│  (不可修改，下单城市锁定)│
├─────────────────────────┤
│  [商品清单]              │
│  五常稻花香 5kg × 2      │
│  ¥89.00                 │
│  小计：¥178.00          │
├─────────────────────────┤
│  [订单金额]              │
│  商品金额：¥178.00      │
│  配送费：¥0.00          │
│  (自提免运费)            │
├─────────────────────────┤
│  [备注]                  │
│  [请填写备注信息...]     │
├─────────────────────────┤
│  [底部]                  │
│  应付金额：¥178.00      │
│  [提交订单]              │
└─────────────────────────┘
```

**业务规则**：
- 订单提交时**锁定城市**，后续不可更改
- 不需要选择收货地址（自提订单）
- 支付成功后立即生成核销码
- 跳转到核销码页面

### 3.6 核销码页面（order/pickup）

**核销码页面（最核心页面）**：
```
┌─────────────────────────┐
│  [订单信息]              │
│  订单号：202510091234567│
│  下单时间：2025-10-09   │
│  配送城市：南通市        │
├─────────────────────────┤
│  [商品信息]              │
│  五常稻花香 5kg × 2      │
│  实付金额：¥178.00      │
├─────────────────────────┤
│  [核销码区域]            │
│  ┌─────────────────┐    │
│  │                 │    │
│  │    238471       │    │  ← 大号字体，加粗
│  │                 │    │
│  └─────────────────┘    │
│                         │
│  有效期至：2025-10-16   │
│  状态：待核销           │
├─────────────────────────┤
│  [自提点列表]            │
│  为您推荐附近自提点 →    │
│                         │
│  📍 张三粮油店           │
│     南通市崇川区xx路xx号 │
│     距离：2.3km          │
│     营业时间：8:00-20:00│
│     ☎️ 138-0013-8000    │
│     [📍 导航] [📞 电话]  │
│                         │
│  📍 李四米业             │
│     南通市港闸区xx路xx号 │
│     距离：5.1km          │
│     ☎️ 139-0013-9000    │
│     [📍 导航] [📞 电话]  │
│                         │
│  [查看更多自提点]        │
└─────────────────────────┘
```

**交互逻辑**：
1. **核销码显示**
   - 6 位数字，大号字体（60rpx）
   - 可长按复制
   - 点击可放大显示（弹窗）

2. **自提点列表**
   - 默认显示最近 3 家
   - 点击"查看更多"显示全部（最多 20 家）
   - 按距离排序（从近到远）
   - 显示：名称、地址、距离、电话、营业时间

3. **导航功能**
   - 点击"导航"调用微信地图
   - 传递商家经纬度
   ```javascript
   wx.openLocation({
     latitude: 31.9808,
     longitude: 120.8954,
     name: '张三粮油店',
     address: '南通市崇川区xx路xx号'
   })
   ```

4. **拨打电话**
   - 点击"电话"直接拨打
   ```javascript
   wx.makePhoneCall({
     phoneNumber: '13800138000'
   })
   ```

5. **核销状态**
   - 待核销：显示核销码，可自提
   - 已核销：显示核销时间、核销商家
   - 已过期：核销码变灰，无法使用

### 3.7 订单列表页（order/list）

**Tab 切换**：
```
┌─────────────────────────┐
│  [Tab 栏]                │
│  全部 | 待核销 | 已完成  │
├─────────────────────────┤
│  [订单列表]              │
│  ┌─────────────────┐    │
│  │ 2025-10-09      │    │
│  │ 订单号：20251009...│  │
│  │ [图] 五常稻花香  │    │
│  │      5kg × 2     │    │
│  │ ¥178.00         │    │
│  │ [状态：待核销]   │    │
│  │ [查看核销码]     │    │  ← 按钮
│  └─────────────────┘    │
└─────────────────────────┘
```

**订单状态**：
- **待核销**：显示"查看核销码"按钮
- **已核销**：显示核销时间、核销商家
- **已取消**：显示取消原因

### 3.8 个人中心（user/index）

**个人中心布局**：
```
┌─────────────────────────┐
│  [用户信息卡片]          │
│  [头像] 用户昵称         │
│  手机号：138****8000    │
├─────────────────────────┤
│  [订单统计]              │
│  待核销(2) 已完成(10)    │
├─────────────────────────┤
│  [功能菜单]              │
│  📋 我的订单             │
│  🏪 附近自提点           │
│  📍 切换城市             │
│  ⚙️  设置                │
│  📞 客服电话             │
│  ℹ️  关于我们            │
└─────────────────────────┘
```

**功能说明**：
- **我的订单**：跳转订单列表
- **附近自提点**：显示当前城市所有自提点（地图模式）
- **切换城市**：手动选择城市
- **设置**：清除缓存、退出登录
- **客服电话**：拨打客服（400-xxx-xxxx）

---

## 四、数据结构定义

### 4.1 商品数据结构
```javascript
{
  id: 1,
  title: '五常稻花香大米',
  images: ['图片1', '图片2', '图片3'],
  category_id: 1,
  category_name: '东北大米',
  specs: [
    { id: 1, name: '5kg', price: 89.00, stock: 100 },
    { id: 2, name: '10kg', price: 169.00, stock: 50 },
    { id: 3, name: '20kg', price: 320.00, stock: 30 }
  ],
  city_prices: [
    { city_code: '320600', city_name: '南通市', price: 89.00 },
    { city_code: '650100', city_name: '乌鲁木齐市', price: 99.00 },
    { city_code: '230100', city_name: '哈尔滨市', price: 79.00 }
  ],
  sales: 1234,
  detail: '商品详情富文本'
}
```

### 4.2 订单数据结构
```javascript
{
  id: 1,
  order_no: '202510091234567',
  user_id: 1,
  city_code: '320600',
  city_name: '南通市',
  goods: [
    {
      goods_id: 1,
      goods_title: '五常稻花香大米',
      spec_id: 1,
      spec_name: '5kg',
      price: 89.00,
      quantity: 2,
      subtotal: 178.00
    }
  ],
  total_amount: 178.00,
  state: 2,  // 1待支付 2待核销 3已核销 7已取消
  pickup_code: '238471',  // 核销码
  pickup_code_expire: '2025-10-16 23:59:59',
  pickup_time: null,  // 核销时间
  pickup_shop_id: null,  // 核销商家ID
  create_time: '2025-10-09 14:30:00',
  pay_time: '2025-10-09 14:31:00'
}
```

### 4.3 商家（自提点）数据结构
```javascript
{
  id: 1,
  name: '张三粮油店',
  city_code: '320600',
  city_name: '南通市',
  address: '南通市崇川区xx路xx号',
  latitude: 31.9808,
  longitude: 120.8954,
  mobile: '13800138000',
  business_hours: '8:00-20:00',
  status: 'normal'  // normal正常 hidden隐藏
}
```

---

## 五、API 接口定义

### 5.1 地理位置相关

#### 获取当前城市价格商品列表
```javascript
GET /api/goods/list
Request: {
  city_code: '320600',  // 城市代码（必填）
  category_id: 1,       // 分类ID（可选）
  keyword: '五常',      // 搜索关键词（可选）
  page: 1,
  limit: 10
}
Response: {
  rows: [
    {
      id: 1,
      title: '五常稻花香大米',
      images: ['图片'],
      price: 89.00,  // 该城市的价格
      sales: 1234
    }
  ],
  total: 50
}
```

#### 获取商品详情（含多城市价格）
```javascript
GET /api/goods/detail
Request: {
  id: 1,
  city_code: '320600'  // 当前城市
}
Response: {
  id: 1,
  title: '五常稻花香大米',
  images: ['图片1', '图片2'],
  current_price: 89.00,  // 当前城市价格
  city_prices: [
    { city_code: '320600', city_name: '南通市', price: 89.00 },
    { city_code: '650100', city_name: '乌鲁木齐市', price: 99.00 }
  ],
  specs: [
    { id: 1, name: '5kg', price: 89.00 },
    { id: 2, name: '10kg', price: 169.00 }
  ]
}
```

### 5.2 订单相关

#### 创建订单
```javascript
POST /api/order/create
Request: {
  city_code: '320600',
  city_name: '南通市',
  goods: [
    {
      goods_id: 1,
      spec_id: 1,
      quantity: 2,
      price: 89.00
    }
  ],
  remark: '备注'
}
Response: {
  order_id: 1,
  order_no: '202510091234567',
  total_amount: 178.00,
  pay_params: {
    // 微信支付参数
  }
}
```

#### 支付成功回调（生成核销码）
```javascript
POST /api/order/pay_notify
Request: {
  order_no: '202510091234567'
}
Response: {
  pickup_code: '238471',
  expire_time: '2025-10-16 23:59:59'
}
```

#### 获取核销码详情
```javascript
GET /api/order/pickup_detail
Request: {
  order_id: 1
}
Response: {
  order_no: '202510091234567',
  pickup_code: '238471',
  city_code: '320600',
  city_name: '南通市',
  state: 2,  // 2待核销 3已核销
  expire_time: '2025-10-16 23:59:59',
  goods: [...],
  shops: [  // 附近自提点
    {
      id: 1,
      name: '张三粮油店',
      address: '南通市崇川区xx路xx号',
      distance: 2.3,  // km
      mobile: '13800138000',
      latitude: 31.9808,
      longitude: 120.8954
    }
  ]
}
```

### 5.3 商家自提点相关

#### 获取附近自提点列表
```javascript
GET /api/shop/nearby
Request: {
  city_code: '320600',
  latitude: 31.9808,
  longitude: 120.8954,
  limit: 20
}
Response: [
  {
    id: 1,
    name: '张三粮油店',
    address: '南通市崇川区xx路xx号',
    distance: 2.3,
    mobile: '13800138000',
    business_hours: '8:00-20:00',
    latitude: 31.9808,
    longitude: 120.8954
  }
]
```

---

## 六、关键代码实现

### 6.1 城市切换功能

**Vuex 状态管理**：
```javascript
// store/modules/city.js
export default {
  namespaced: true,
  state: {
    currentCity: {
      code: '',
      name: ''
    }
  },
  mutations: {
    SET_CITY(state, city) {
      state.currentCity = city
      uni.setStorageSync('currentCity', city)
    }
  },
  actions: {
    // 自动定位获取城市
    async autoLocate({ commit }) {
      const location = await uni.getLocation({ type: 'gcj02' })
      const city = await reverseGeocode(location.latitude, location.longitude)
      commit('SET_CITY', {
        code: city.adcode,
        name: city.city
      })
    },
    // 手动切换城市
    selectCity({ commit }, city) {
      commit('SET_CITY', city)
      // 通知所有页面刷新价格
      uni.$emit('cityChanged', city)
    }
  }
}
```

**商品列表监听城市变化**：
```javascript
// pages/goods/list.vue
export default {
  data() {
    return {
      goodsList: []
    }
  },
  computed: {
    ...mapState('city', ['currentCity'])
  },
  watch: {
    'currentCity.code'() {
      this.refreshList()
    }
  },
  methods: {
    async refreshList() {
      const res = await getGoodsList({
        city_code: this.currentCity.code,
        page: 1,
        limit: 10
      })
      this.goodsList = res.rows
    }
  }
}
```

### 6.2 购物车城市价格处理

**购物车数据结构**：
```javascript
// store/modules/cart.js
export default {
  state: {
    cartList: [
      {
        id: 1,  // 购物车ID
        goods_id: 1,
        spec_id: 1,
        quantity: 2,
        city_code: '320600',  // 加入购物车时的城市
        price: 89.00,         // 加入购物车时的价格
        goods_title: '五常稻花香大米',
        spec_name: '5kg',
        image: 'xxx'
      }
    ]
  },
  actions: {
    // 切换城市后更新价格
    async updatePricesByCity({ state, commit }, cityCode) {
      for (let item of state.cartList) {
        const res = await getGoodsPrice({
          goods_id: item.goods_id,
          spec_id: item.spec_id,
          city_code: cityCode
        })
        item.price = res.price
        item.city_code = cityCode
      }
      commit('SET_CART_LIST', [...state.cartList])
    }
  }
}
```

### 6.3 核销码页面实现

**核销码页面完整代码**：
```vue
<template>
  <view class="pickup-page">
    <!-- 订单信息 -->
    <view class="order-info">
      <u-cell title="订单号" :value="orderDetail.order_no" />
      <u-cell title="下单时间" :value="orderDetail.create_time" />
      <u-cell title="配送城市" :value="orderDetail.city_name" />
    </view>

    <!-- 商品信息 -->
    <view class="goods-info">
      <view class="goods-item" v-for="item in orderDetail.goods" :key="item.id">
        <image :src="item.image" class="goods-image" />
        <view class="goods-detail">
          <text class="goods-title">{{ item.goods_title }}</text>
          <text class="goods-spec">{{ item.spec_name }} × {{ item.quantity }}</text>
        </view>
        <text class="goods-price">¥{{ item.subtotal }}</text>
      </view>
      <view class="total">实付金额：¥{{ orderDetail.total_amount }}</view>
    </view>

    <!-- 核销码 -->
    <view class="pickup-code-box">
      <text class="label">核销码</text>
      <view class="code-area" @longpress="copyCode">
        <text class="code">{{ orderDetail.pickup_code }}</text>
      </view>
      <text class="expire">有效期至：{{ orderDetail.pickup_code_expire }}</text>
      <text class="status">状态：{{ stateText }}</text>
    </view>

    <!-- 自提点列表 -->
    <view class="shop-list">
      <view class="list-title">
        <text>为您推荐附近自提点</text>
        <text class="more" @click="showAllShops">查看更多 ></text>
      </view>
      <view class="shop-item" v-for="shop in shopList.slice(0, 3)" :key="shop.id">
        <view class="shop-info">
          <text class="shop-name">📍 {{ shop.name }}</text>
          <text class="shop-address">{{ shop.address }}</text>
          <text class="shop-distance">距离：{{ shop.distance }}km</text>
          <text class="shop-hours">营业时间：{{ shop.business_hours }}</text>
        </view>
        <view class="shop-actions">
          <u-button size="small" @click="navigate(shop)">📍 导航</u-button>
          <u-button size="small" @click="call(shop)">📞 电话</u-button>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import { getPickupDetail } from '@/api/order-api'

export default {
  data() {
    return {
      orderId: '',
      orderDetail: {},
      shopList: []
    }
  },
  computed: {
    stateText() {
      const map = { 2: '待核销', 3: '已核销', 7: '已取消' }
      return map[this.orderDetail.state] || ''
    }
  },
  onLoad(options) {
    this.orderId = options.id
    this.loadDetail()
  },
  methods: {
    async loadDetail() {
      const res = await getPickupDetail({ order_id: this.orderId })
      this.orderDetail = res
      this.shopList = res.shops
    },
    copyCode() {
      uni.setClipboardData({
        data: this.orderDetail.pickup_code,
        success: () => {
          uni.showToast({ title: '核销码已复制' })
        }
      })
    },
    navigate(shop) {
      wx.openLocation({
        latitude: shop.latitude,
        longitude: shop.longitude,
        name: shop.name,
        address: shop.address
      })
    },
    call(shop) {
      wx.makePhoneCall({
        phoneNumber: shop.mobile
      })
    },
    showAllShops() {
      uni.navigateTo({ url: '/pages/shop/list?city_code=' + this.orderDetail.city_code })
    }
  }
}
</script>

<style lang="scss" scoped>
.pickup-code-box {
  background: #fff;
  padding: 40rpx;
  margin: 20rpx;
  border-radius: 16rpx;
  text-align: center;

  .label {
    font-size: 28rpx;
    color: #666;
  }

  .code-area {
    margin: 30rpx 0;
    padding: 40rpx;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16rpx;
  }

  .code {
    font-size: 80rpx;
    font-weight: bold;
    color: #fff;
    letter-spacing: 10rpx;
  }

  .expire, .status {
    display: block;
    font-size: 24rpx;
    color: #999;
    margin-top: 10rpx;
  }
}

.shop-item {
  background: #fff;
  padding: 24rpx;
  margin: 20rpx;
  border-radius: 12rpx;
  display: flex;
  justify-content: space-between;

  .shop-name {
    font-size: 32rpx;
    font-weight: bold;
    color: #333;
  }

  .shop-address {
    font-size: 26rpx;
    color: #666;
    margin-top: 8rpx;
  }

  .shop-distance, .shop-hours {
    font-size: 24rpx;
    color: #999;
    margin-top: 8rpx;
  }

  .shop-actions {
    display: flex;
    flex-direction: column;
    gap: 10rpx;
  }
}
</style>
```

---

## 七、重要业务规则总结

### 7.1 地理位置定价规则
1. 用户首次进入小程序必须授权地理位置
2. 定位精确到地级市（如：南通市）
3. 商品价格根据城市动态展示
4. 用户可手动切换城市查看价格
5. 购物车价格随城市切换实时更新
6. 下单时锁定城市，后续不可更改

### 7.2 核销码规则
1. 支付成功后立即生成 6 位数字核销码
2. 核销码有效期 7 天
3. 一个核销码只能核销一次
4. 核销后订单状态变为"已核销"
5. 过期核销码自动失效，不可使用
6. 核销码可长按复制

### 7.3 自提点规则
1. 用户支付后才能看到自提点列表
2. 自提点列表按距离排序
3. 显示距离、地址、电话、营业时间
4. 提供导航和拨打电话功能
5. 自提点属于订单所在城市
6. 商家扫描或输入核销码完成核销

### 7.4 订单状态流转
```
待支付(1) → 支付 → 待核销(2) → 商家核销 → 已核销(3) → 已完成
                ↓
            取消 → 已取消(7)
```

---

## 八、样式规范

### 8.1 颜色规范
```scss
// 主题色
$primary: #07c160;       // 微信绿
$danger: #ee0a24;        // 价格红
$warning: #ff976a;       // 警告橙
$success: #07c160;       // 成功绿

// 文字色
$text-primary: #333;     // 主文字
$text-secondary: #666;   // 次要文字
$text-placeholder: #999; // 占位符
$text-disabled: #ccc;    // 禁用

// 背景色
$bg-page: #f7f8fa;       // 页面背景
$bg-white: #fff;         // 卡片背景

// 边框色
$border: #ebedf0;
```

### 8.2 间距规范（8px 栅格）
```scss
$spacing-xs: 8rpx;
$spacing-sm: 16rpx;
$spacing-md: 24rpx;
$spacing-lg: 32rpx;
$spacing-xl: 40rpx;
```

### 8.3 字体规范
```scss
$font-xs: 24rpx;
$font-sm: 26rpx;
$font-md: 28rpx;
$font-lg: 32rpx;
$font-xl: 36rpx;
$font-xxl: 40rpx;
```

---

## 九、开发优先级

### 第一阶段（MVP 核心功能）
1. ✅ 地理位置获取与城市识别
2. ✅ 商品列表（基于城市定价）
3. ✅ 商品详情（规格选择、价格展示）
4. ✅ 购物车（城市价格联动）
5. ✅ 订单确认与支付
6. ✅ 核销码生成与展示
7. ✅ 自提点列表与导航
8. ✅ 订单列表与详情

### 第二阶段（辅助功能）
1. 个人中心完善
2. 城市选择器优化
3. 附近自提点地图模式
4. 订单搜索与筛选

### 第三阶段（增值功能）
1. 优惠券系统
2. 积分系统
3. 分享赚佣金
4. 在线客服

---

## 十、测试用例

### 10.1 城市切换测试
```
测试场景：用户在南通市查看商品，切换到乌鲁木齐市
预期结果：
1. 商品列表价格自动更新
2. 购物车商品价格更新
3. 弹窗提示"已切换至乌鲁木齐市"
4. 顶部城市栏显示"乌鲁木齐市"
```

### 10.2 核销码测试
```
测试场景：用户下单支付成功
预期结果：
1. 生成 6 位数字核销码（如：238471）
2. 跳转到核销码页面
3. 显示自提点列表（按距离排序）
4. 可导航、可拨打电话
5. 核销码可长按复制
```

### 10.3 订单状态测试
```
测试场景：订单从创建到核销的完整流程
1. 创建订单 → 状态：待支付
2. 支付成功 → 状态：待核销，生成核销码
3. 商家核销 → 状态：已核销
4. 7天后 → 状态：已完成
```

---

## 十一、常见问题 FAQ

### Q1：用户在 A 城市加入购物车，到了 B 城市下单，价格会变吗？
**答**：会变。切换城市后，购物车价格自动更新为 B 城市的价格。结算时弹窗提示用户确认。

### Q2：核销码过期后怎么办？
**答**：核销码过期（7天后）自动失效，订单状态变为"已取消"。用户需重新下单。

### Q3：用户可以指定某个商家自提吗？
**答**：不可以。用户只能看到核销码和自提点列表，无法指定商家。到任意自提点核销即可。

### Q4：商品价格如何维护？
**答**：后台管理系统中，为每个商品配置不同城市的价格。格式如下：
```json
{
  "goods_id": 1,
  "city_prices": [
    { "city_code": "320600", "price": 89.00 },
    { "city_code": "650100", "price": 99.00 }
  ]
}
```

### Q5：如何防止核销码被重复使用？
**答**：
1. 核销码与订单一对一绑定
2. 商家核销时后端验证核销码状态
3. 核销成功后立即更新订单状态为"已核销"
4. 已核销的订单不可再次核销

---

## 十二、后续扩展方向

1. **多规格组合**：同一订单购买多种大米
2. **会员等级**：不同等级享受不同价格
3. **批发模式**：大量采购享受批发价
4. **预售模式**：新米上市提前预定
5. **配送到家**：部分城市支持快递配送
6. **商家入驻**：商家可自主上架商品

---

**最后更新时间**：2025-10-09

**使用说明**：将此文档提供给 AI 代码生成工具（如 Claude/Cursor），可直接生成符合业务逻辑的小程序代码。
